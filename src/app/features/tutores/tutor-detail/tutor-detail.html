<div class="detail-container">
  <!-- Loading -->
  <div *ngIf="isloading" class="loading">
    â³ Carregando dados do tutor...
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-message">
    <span>{{ errorMessage }}</span>
    <button (click)="errorMessage = ''" style="background: none; border: none; cursor: pointer; font-size: 20px;">âœ–</button>
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="success-message">
    {{ successMessage }}
  </div>

  <!-- Tutor Detail -->
  <div *ngIf="!isloading && tutor" class="tutor-detail">
    <!-- Header with Back and Actions -->
    <div class="detail-header">
      <button class="btn-back" (click)="voltar()">
        â† Voltar
      </button>
      <div class="header-actions">
        <button class="btn-edit" (click)="editarTutor(tutor.id!)">
          âœï¸ Editar
        </button>
        <button class="btn-delete" (click)="deletarTutor()" [disabled]="tutor.pets && tutor.pets.length > 0">
          ğŸ—‘ï¸ Excluir
        </button>
      </div>
    </div>

    <!-- Tutor Info Card -->
    <div class="tutor-info-card">
      <div class="tutor-photo">
        <img *ngIf="getFotoUrl(tutor.foto)" [src]="getFotoUrl(tutor.foto)" [alt]="tutor.nome">
        <div *ngIf="!getFotoUrl(tutor.foto)" class="photo-placeholder">ğŸ‘¤</div>
      </div>

      <div class="tutor-data">
        <h1>{{ tutor.nome }}</h1>
        
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">CPF:</span>
            <span class="info-value">{{ tutor.cpf }}</span>
          </div>

          <div class="info-item">
            <span class="info-label">Telefone:</span>
            <span class="info-value">{{ tutor.telefone }}</span>
          </div>

          <div class="info-item">
            <span class="info-label">Email:</span>
            <span class="info-value">{{ tutor.email || 'NÃ£o informado' }}</span>
          </div>

          <div class="info-item full-width">
            <span class="info-label">EndereÃ§o:</span>
            <span class="info-value">{{ tutor.endereco || 'NÃ£o informado' }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Pets Section -->
    <div class="pets-section">
      <div class="section-header">
        <h2>ğŸ¾ Pets Vinculados</h2>
        <button class="btn-vincular" (click)="abrirModalVincular()" [disabled]="loadingVincul">
          {{ loadingVincul ? 'â³ Processando...' : '+ Vincular Pet' }}
        </button>
      </div>

      <!-- Pets Grid -->
      <div *ngIf="tutor.pets && tutor.pets.length > 0" class="pets-grid">
      <div *ngFor="let pet of tutor.pets" class="pet-card">
      <div class="pet-image" [class.empty-photo]="!getFotoUrl(pet.foto)">
      <img 
        *ngIf="getFotoUrl(pet.foto)" 
        [src]="getFotoUrl(pet.foto)" 
        [alt]="pet.nome">
      <span *ngIf="!getFotoUrl(pet.foto)">ğŸ¾</span>
      </div>

          <div class="pet-info">
            <h3>{{ pet.nome }}</h3>
            <p><strong>EspÃ©cie:</strong> {{ pet.especie }}</p>
            <p><strong>RaÃ§a:</strong> {{ pet.raca }}</p>
            <p><strong>Idade:</strong> {{ pet.idade }} {{ pet.idade === 1 ? 'ano' : 'anos' }}</p>
          </div>

          <div class="pet-actions">
            <button class="btn-view-pet" (click)="verPet(pet.id)" [disabled]="loadingVincul">
              ğŸ‘ï¸ Ver Detalhes
            </button>
            <button class="btn-desvincular" (click)="desvincularPet(pet.id)" [disabled]="loadingVincul">
              {{ loadingVincul ? 'â³' : 'ğŸ”—' }} Desvincular
            </button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!tutor.pets || tutor.pets.length === 0" class="empty-pets">
        <span class="empty-icon">ğŸ¾</span>
        <p>Nenhum pet vinculado a este tutor ainda.</p>
        <button class="btn-vincular-empty" (click)="abrirModalVincular()">
          + Vincular Primeiro Pet
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Vincular Pet -->
  <div *ngIf="showVincularModal" class="modal-overlay" (click)="fecharModalVincular()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Vincular Pet ao Tutor</h3>
        <button class="modal-close" (click)="fecharModalVincular()">âœ–</button>
      </div>

      <div class="modal-body">
        <p class="modal-description">Selecione um pet disponÃ­vel para vincular a este tutor:</p>
        
        <select 
          *ngIf="petsDisponiveis.length > 0" 
          class="pet-select" 
          [(ngModel)]="petSelecionado"
          [disabled]="loadingVincul">
          <option value="">-- Selecione um pet --</option>
          <option *ngFor="let pet of petsDisponiveis" [value]="pet.id">
            {{ pet.nome }} ({{ pet.raca || 'RaÃ§a nÃ£o informada' }})
          </option>
        </select>

        <div *ngIf="petsDisponiveis.length === 0" class="no-pets-available">
          âš ï¸ NÃ£o hÃ¡ pets disponÃ­veis para vinculaÃ§Ã£o.
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn-cancel-modal" (click)="fecharModalVincular()" [disabled]="loadingVincul">
          Cancelar
        </button>
        <button 
          class="btn-confirm-modal" 
          (click)="vincularPet()" 
          [disabled]="!petSelecionado || loadingVincul">
          {{ loadingVincul ? 'â³ Vinculando...' : 'Confirmar VinculaÃ§Ã£o' }}
        </button>
      </div>
    </div>
  </div>
</div>